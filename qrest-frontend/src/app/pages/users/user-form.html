<div class="p-6 max-w-xl mx-auto">
  <h1 class="text-2xl font-bold mb-6">
    {{ mode === 'create' ? 'Crear Usuario' : 'Editar Usuario' }}
  </h1>

  <!-- Loading when fetching user -->
  <div *ngIf="loading" class="text-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
    <p class="mt-4 text-gray-600">Cargando usuario...</p>
  </div>

  <!-- Form -->
  <form *ngIf="!loading" (ngSubmit)="submit()" class="space-y-4">

    <!-- Username -->
    <div>
      <label class="block mb-1 font-medium">Usuario</label>
      <input
        [(ngModel)]="model.username"
        name="username"
        required
        class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300"
        placeholder="Ingresa el nombre del usuario"
      />
    </div>

    <!-- Password -->
    <div>
      <label class="block mb-1 font-medium">
        Contraseña
        <span *ngIf="mode === 'edit'" class="text-gray-500 text-sm">(opcional)</span>
      </label>

      <input
        [(ngModel)]="model.password"
        name="password"
        type="password"
        class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300"
        placeholder="{{ mode === 'create' ? 'Ingresa contraseña' : 'Dejar vacío para no cambiar' }}"
      />
    </div>

    <!-- Roles -->
    <div>
      <label class="block mb-1 font-medium">
        Roles (separados por coma)
      </label>

      <input
        [(ngModel)]="model.rolesString"
        name="rolesString"
        class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300"
        placeholder="Ejemplo: ROLE_ADMIN, ROLE_USER"
        (ngModelChange)="onRolesChange($event)"
      />

      <div class="mt-2 flex flex-wrap gap-2">
        <span
          *ngFor="let r of model.roles"
          class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-800"
        >
          {{ r }}
        </span>
      </div>
    </div>

    <!-- Active Toggle -->
    <div class="flex items-center gap-2 mt-4">
      <input
        type="checkbox"
        class="w-4 h-4"
        [(ngModel)]="model.active"
        name="active"
      />
      <label class="text-sm">Usuario activo</label>
    </div>

    <!-- Buttons -->
    <div class="flex justify-end gap-3 mt-6">
      <button
        type="button"
        class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300"
        (click)="cancel()"
      >
        Cancelar
      </button>

      <button
        type="submit"
        [disabled]="loading"
        class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50"
      >
        {{ loading ? 'Guardando...' : (mode === 'create' ? 'Crear' : 'Actualizar') }}
      </button>
    </div>
  </form>
</div>
